<!DOCTYPE html>
<html lang="zh">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>问卷调查</title>
    <script type="text/javascript">
        window.onload = function() {
            // 检查之前是否已经尝试过跳转，防止死循环
            if (sessionStorage.getItem('redirectAttempted') === 'true') {
                console.log('Previous redirect attempt detected, preventing loop');
                document.getElementById('manualLink').style.display = 'block';
                document.getElementById('errorMessage').style.display = 'block';
                return;
            }
            
            // 标记已经尝试过跳转
            sessionStorage.setItem('redirectAttempted', 'true');
            
            setTimeout(function() {
                try {
                    // 添加随机参数防止缓存问题
                    const timestamp = new Date().getTime();
                    // 修正为正确的相对路径
                    window.location.href = "./e7.m24.top/wjdc4/index.html?t=" + timestamp;
                } catch(e) {
                    console.error("Redirect failed: ", e);
                    document.getElementById('manualLink').style.display = 'block';
                    document.getElementById('errorMessage').style.display = 'block';
                }
            }, 2000);
        }
    </script>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f5f5f7;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
        }

        .loader {
            width: 48px;
            height: 48px;
            border: 5px solid #FFF;
            border-bottom-color: #FF3D00;
            border-radius: 50%;
            display: inline-block;
            box-sizing: border-box;
            animation: rotation 1s linear infinite;
        }

        @keyframes rotation {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        } 
    </style>
</head>
<body>
    <h1>正在加载问卷调查...</h1>
    <span class="loader"></span>
    <p id="manualLink">如果页面未自动跳转，<a href="./e7.m24.top/wjdc4/index.html?t=manual" id="manualRedirectLink">请点击这里</a></p>
    <script>
        // 为手动链接添加时间戳
        document.addEventListener('DOMContentLoaded', function() {
            const manualLink = document.getElementById('manualRedirectLink');
            if(manualLink) {
                const timestamp = new Date().getTime();
                manualLink.href = "./e7.m24.top/wjdc4/index.html?t=" + timestamp;
            }
        });
    </script>
    <div id="errorMessage" style="display:none; margin-top: 20px; color: #ff3d00; text-align: center;">
        <p>加载遇到问题，请尝试手动点击上面的链接</p>
        <p>或者 <a href="../index.html?completed_520=true">返回主页</a></p>
    </div>
    
    <script>
        // 检测是否从已经从主页重定向而来
        if (window.location.href.indexOf('?t=') !== -1) {
            // 标记这是一个正常的重定向
            sessionStorage.setItem('normalRedirect', 'true');
        }
        
        // 如果跳转失败，提供返回主页的选项
        function returnToMainPage() {
            window.location.href = "../index.html?completed_520=true";
        }
    </script>
</body>
</html>
